{"paragraphs":[{"text":"%md\n\n# JVMs Compare - Analyze Benchmarks using Apache Zeppelin\n\n## Introduction\nThe Notebook is setup as a spark job (paragraph) followed by SQL query paragraphs. The spark paragraph extracts benchmark results and converts/squashes them into a single queryable view.\n\nComments in the spark paragraph help understand when is happening. There are comments that are prefixed with a *NOTE*. These comments indicate possible action being required.\n\nValues marked as *NOTE* are:\n\n1. *`project_dir`*: This val represents the directory where the benchmark source was cloned from git. This directory is where a new `benchmark-results` directory will be created.\n2. *`jdks`*: This val represts an array of JDK names. These JDKs were used for running the benchmarks. The order of the JDKs here matches the order (and prefixed number) for their results. For instance, GraalCE is the 3rd JDK run, per the project source (see: https://github.com/c-guntur/jvms-compare/blob/master/run-all.sh). Thus, GraalCE should be listed third in the *`jdks`* val below.\n3. *`size`*: This val represents the number of elements seeded into the collection prior to running the benchmark. Typical values used in the past include ***1 Thousand*** and ***1 Million***. Setting the right value is important since benchmark results may vary based on the size of the seeded data.\n\n## Information\nThe Notebook pulls numeric data from the CSV files by iterating over directories under the *`project_dir/benchmark-results`*. In addition, some synthetic columns and a transformation of a column are performed.\n\nColumns:\n\n* *Benchmark*: Name of the benchmark (this column is ***transformed*** to trim the name to the simple class name and method name of the benchmark).\n* *Mode*: Displays the benchmarking mode. Typically Throughput is the normal benchhmark. *The higher the throughput, the better the performance*.\n* *Threads*: Displays the number of threads used to run the benchmarks.\n* *Samples*: Displays the number of samples collected to fetch the benchmark statistics.\n* *Score*: Displays the benchmark score.\n* *Error*: Displays the benchmark error rate.\n* *Units*: Displays the units used for measuring.\n* *JDK*: Synthetic column based on the CSV file prefix. Maps to the *`jdks`* to determine the JDK used.\n* *Size*: Synthetic column based on the val *`size`*. This column displays the seed-data size used during the benchmark run.\n","user":"anonymous","dateUpdated":"2019-11-29T08:20:53-0500","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1575031839168_981479656","id":"20191129-075039_947844539","dateCreated":"2019-11-29T07:50:39-0500","dateStarted":"2019-11-29T08:20:29-0500","dateFinished":"2019-11-29T08:20:29-0500","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:20688"},{"text":"import org.apache.spark.sql.functions._\n\n// NOTE: Update this directory to match where your JVMs Compare Benchmark Results in CSV format are located.\nval project_dir = \"/Users/cguntur/projects/jvms-compare\"\nval benchmark_dir = project_dir + \"/benchmark-results\"\nprintln(\"Using benchmark results from: \" + benchmark_dir)\n\n// NOTE: Update this list if there are other or different JDKs being compared.\nval jdks = List(\"OracleJDK8\", \"GraalEE\", \"GraalCE\", \"AdoptOpenJDK8Hotspot\", \"AdoptOpenJDKOpenJ9\", \"OpenJDK11Hotspot\", \"OpenJDK11Graal\", \"GraalEEC2\")\n\n//NOTE: This was a run with 1k element size. Alter value if a different size is used during the benchmark execution.\nval size = \"1 Thousand\"\n\n// Use the project's dummy.csv to create a dataframe with the right columns. This csv file has no data.\nvar dummyData = spark.read.option(\"header\", \"true\").csv(project_dir + \"/\" + \"dummy.csv\")\n\n// Create a \"sink\" dataframe with no data, but right columns, so each benchmark-result can be merged onto this dataframe\nvar dataFrame = dummyData.toDF(\"Benchmark\", \"Mode\", \"Threads\", \"Samples\", \"Score\", \"Error\", \"Units\", \"JDK\", \"Size\")\n\n// Iterate over the 01 through 08 numbered result CSV files where each prefixed number represents a run of the benchmarks with a specific JDK\n// NOTE: see the val 'jdks' that map to these numbers\nfor (i <- 1 to 8) {\n\n    // Iterate over every CSV in each directory under benchmark-results for the current index (index represents a JDK)\n    var csvFile = benchmark_dir+\"/*/0\" + i + \"*.csv\"\n    var benchmarkData = spark.read.option(\"header\", \"true\").csv(csvFile)\n\n    // Extract direct columns from the CSV data\n    var df = benchmarkData.toDF(\"Benchmark\", \"Mode\", \"Threads\", \"Samples\", \"Score\", \"Error\", \"Units\")\n\n    // --- BEGIN: DATA NOT FROM CSV ---\n    // Add a JDK and a Size column. Trim the Benchmark name.\n    // --------------------------------\n    \n    // Add a JDK column with values that are sequentially listed in the jdks val above. \n    // JDKs map to the prefixed number in the results.\n    // For instance, OracleJDK8 is the first run and its prefix for results is 01.\n    df = df.withColumn(\"JDK\", when($\"Mode\".isNull, \"\").otherwise(jdks(i - 1)))\n\n    // Add a Benchmark column that extracts its value from the CSV Benchmark column\n    df = df.withColumn(\"Benchmark\", substring($\"Benchmark\", 23, 200))\n    \n    // Add a size column that holds the size of the data tested in the benchmark. Default value in the note is '1 Thousand'.\n    // NOTE: see the val 'size' that determines the volume tested per becnmark run.\n    df = df.withColumn(\"Size\", when($\"Mode\".isNull, \"\").otherwise(size))\n\n    // ------------------------------\n    // --- END: DATA NOT FROM CSV ---\n\n    // Merge the data collected from each CSV into the \"sink\" dataframe\n    dataFrame = dataFrame.union(df)\n}\n\n// Generate (or replace) a temporary view with the name 'benchmarks' that can now be queried.\ndataFrame.createOrReplaceTempView(\"benchmarks\")","user":"anonymous","dateUpdated":"2019-11-29T07:41:21-0500","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{"benchmark_dir":""},"forms":{}},"apps":[],"jobName":"paragraph_1575031281802_-1743435665","id":"20191111-225606_73930282","dateCreated":"2019-11-29T07:41:21-0500","dateStarted":"2019-11-29T07:49:20-0500","dateFinished":"2019-11-29T07:49:23-0500","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:20689"},{"text":"%sql\n\n-- SHOW THE NUMBER OF BENCHMARKS COLLECTED PER JDK\n\nselect JDK, count(*) from benchmarks\ngroup by \n  JDK\norder by \n  JDK","user":"anonymous","dateUpdated":"2019-11-29T07:41:21-0500","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":6,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"JDK":"string","count(1)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"JDK","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count(1)","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1575031281804_-1614277364","id":"20191129-072014_755684939","dateCreated":"2019-11-29T07:41:21-0500","dateStarted":"2019-11-29T07:49:23-0500","dateFinished":"2019-11-29T07:49:25-0500","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:20690"},{"text":"%sql \n\n-- SHOW THE BENCHMARK NAMES RUN FOR ANY JDK\n\nselect Benchmark, count(*) from benchmarks\nwhere \n  JDK=\"${JDK=OracleJDK8}\"\ngroup by\n  Benchmark\norder by\n  Benchmark","user":"anonymous","dateUpdated":"2019-11-29T07:41:21-0500","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":6,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"Benchmark":"string","count(1)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"Benchmark","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count(1)","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{"JDK":"GraalEE"},"forms":{"JDK":{"type":"TextBox","name":"JDK","defaultValue":"OracleJDK8","hidden":false,"$$hashKey":"object:20795"}}},"apps":[],"jobName":"paragraph_1575031281804_633516542","id":"20191129-072442_1365045792","dateCreated":"2019-11-29T07:41:21-0500","dateStarted":"2019-11-29T07:49:25-0500","dateFinished":"2019-11-29T07:49:27-0500","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:20691"},{"text":"%sql \n\n-- VERIFY 8 RUNS FOR A GIVEN BENCHMARK TYPE\n\nselect Benchmark, count(*) from benchmarks\nwhere \n  Benchmark like \"${BenchmarkClass=PersonFilterAndGroup}%\"\nand \n  Benchmark like \"%${BenchmarkType=ECEager_serial}%\"\ngroup by\n  Benchmark","user":"anonymous","dateUpdated":"2019-11-29T07:41:21-0500","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"editorHide":false,"runOnSelectionChange":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{"columns":[{"name":"count(1)","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"JDK","visible":true,"width":"*","sort":{},"filters":[{"term":""}],"pinned":""}],"scrollFocus":{},"selection":[],"grouping":{"grouping":[],"aggregations":[],"rowExpandedStates":{}},"treeView":{},"pagination":{"paginationCurrentPage":1,"paginationPageSize":250}},"tableColumnTypeState":{"names":{"Benchmark":"string","count(1)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":true,"showPagination":false,"showAggregationFooter":true},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","stacked":false},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default","style":"stream"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"pieChart":{}},"commonSetting":{},"keys":[{"name":"Benchmark","index":0,"aggr":"sum"}],"groups":[{"name":"count(1)","index":1,"aggr":"sum"}],"values":[]},"helium":{}}},"enabled":true},"settings":{"params":{"Benchmark":"IntListFilter.filterEC","BenchmarkClass":"PersonFilterAndGroup","BenchmarkType":"ECEager_serial","JDK":"GraalEE"},"forms":{"BenchmarkClass":{"type":"TextBox","name":"BenchmarkClass","defaultValue":"PersonFilterAndGroup","hidden":false,"$$hashKey":"object:20815"},"BenchmarkType":{"type":"TextBox","name":"BenchmarkType","defaultValue":"ECEager_serial","hidden":false,"$$hashKey":"object:20816"}}},"apps":[],"jobName":"paragraph_1575031281804_-332217539","id":"20191111-230359_705590019","dateCreated":"2019-11-29T07:41:21-0500","dateStarted":"2019-11-29T07:49:27-0500","dateFinished":"2019-11-29T07:49:28-0500","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:20692"},{"text":"%sql\n\nselect * from benchmarks","user":"anonymous","dateUpdated":"2019-11-29T08:05:46-0500","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"Benchmark":"string","Mode":"string","Threads":"string","Samples":"string","Score":"string","Error":"string","Units":"string","JDK":"string","Size":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1575032719104_-1363907472","id":"20191129-080519_1990860225","dateCreated":"2019-11-29T08:05:19-0500","dateStarted":"2019-11-29T08:05:44-0500","dateFinished":"2019-11-29T08:05:45-0500","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:20693"},{"user":"anonymous","dateUpdated":"2019-11-29T07:41:21-0500","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1575031281805_-1663950236","id":"20191111-231156_520741420","dateCreated":"2019-11-29T07:41:21-0500","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:20694"}],"name":"Benchmarks/Main/CSV","id":"2ET4DGX1B","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}
